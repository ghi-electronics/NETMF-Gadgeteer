<?xml version="1.0" encoding="utf-8" ?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  
  <?include $(sys.CURRENTDIR)common.wxi?>

  <Module Id="id_mainboard_msm" Language="0" Version="$(var.MainboardSoftwareVersion)">

    <Package Id="$(var.guid_msm_package_id)" 
             InstallerVersion="100" 
             Languages="1033" 
             Manufacturer="$(var.FullManufacturer)" 
             SummaryCodepage="1252" 
             AdminImage="no" />

    <!-- <Property Id="ALLUSERS" Value="2"/> -->

    <Directory Id='TARGETDIR' Name='SourceDir'>
      
      <!--Files-->
      <Directory Id='ProgramFilesFolder' Name='PFiles'>
        <Directory Id='id_dir_mfgr' Name='$(var.FullManufacturer)'>
          <Directory Id='id_dir_gdgtr' Name='!(loc.GadgeteerDirectoryName)'>
            <Directory Id='id_dir_mainboards' Name='!(loc.MainboardDirectoryName)'>
              <Directory Id='INSTALLDIR' Name='$(var.SafeMainboardName)'>

                <!-- The GadgeteerHardware.xml file is mandatory, or else the designer won't pick up this mainboard -->
                <Component Id='id_comp_gadgeteerhardware' Guid='$(var.guid_msm_comp_gadgeteerhardware_id)'>
                  <File Id="id_file_gadgeteerhardware" Source="$(var.SourcePath)\GadgeteerHardware.xml" KeyPath="yes"/>
                </Component>

                <!-- Even if you do not have an image, leave the default zero-length file so you can easily add one later -->
                <Directory Id="id_dir_resources" Name="Resources">
                  <Component Id="id_comp_resources" Guid="$(var.guid_msm_comp_resources_id)">
                    <File Id="id_file_res_image.jpg" Source="$(var.SourcePath)\Image.jpg" KeyPath="yes"/>
                  </Component>
                </Directory>

                <!-- NETMF 4.2 -->
                <?ifdef NETMF42Supported ?>
                <Directory Id="id_dir_netmf_42" Name="NETMF 4.2" FileSource="$(var.SourcePath)..\$(var.ProjectPath)_42\bin\Release\">
                  <Component Id="id_comp_files_42" Guid="$(var.guid_msm_comp_files_id_42)">
                    <File Id="id_file_binary_42" Name="$(var.OutputFileName).dll" KeyPath="yes"/>
                    <File Id="id_file_pdb_42" Name="$(var.OutputFileName).pdb" />
                    <File Id="id_file_xml_42" Name="$(var.OutputFileName).XML" />
                  </Component>

                  <Directory Id="id_dir_be_42" Name="be">
                    <Component Id="id_comp_files_be_42" Guid="$(var.guid_msm_comp_files_be_id_42)">
                      <File Id="id_file_be_binary_42" Name="$(var.OutputFileName).dll" KeyPath="yes"/>
                      <File Id="id_file_be_pdb_42" Name="$(var.OutputFileName).pdb" />
                      <File Id="id_file_be_pdbx_42" Name="$(var.OutputFileName).pdbx" />
                      <File Id="id_file_be_pe_42" Name="$(var.OutputFileName).pe" />
                    </Component>
                  </Directory>

                  <Directory Id="id_dir_le_42" Name="le">
                    <Component Id="id_comp_files_le_42" Guid="$(var.guid_msm_comp_files_le_id_42)">
                      <File Id="id_file_le_binary_42" Name="$(var.OutputFileName).dll" KeyPath="yes"/>
                      <File Id="id_file_le_pdb_42" Name="$(var.OutputFileName).pdb" />
                      <File Id="id_file_le_pdbx_42" Name="$(var.OutputFileName).pdbx" />
                      <File Id="id_file_le_pe_42" Name="$(var.OutputFileName).pe" />
                    </Component>
                  </Directory>
                </Directory>
                <?endif ?>

                <!-- NETMF 4.3 -->
                <?ifdef NETMF43Supported ?>
                <Directory Id="id_dir_netmf_43" Name="NETMF 4.3" FileSource="$(var.SourcePath)..\$(var.ProjectPath)_43\bin\Release\">
                  <Component Id="id_comp_files_43" Guid="$(var.guid_msm_comp_files_id_43)">
                    <File Id="id_file_binary_43" Name="$(var.OutputFileName).dll" KeyPath="yes"/>
                    <File Id="id_file_pdb_43" Name="$(var.OutputFileName).pdb" />
                    <File Id="id_file_xml_43" Name="$(var.OutputFileName).XML" />
                  </Component>

                  <Directory Id="id_dir_be_43" Name="be">
                    <Component Id="id_comp_files_be_43" Guid="$(var.guid_msm_comp_files_be_id_43)">
                      <File Id="id_file_be_binary_43" Name="$(var.OutputFileName).dll" KeyPath="yes"/>
                      <File Id="id_file_be_pdb_43" Name="$(var.OutputFileName).pdb" />
                      <File Id="id_file_be_pdbx_43" Name="$(var.OutputFileName).pdbx" />
                      <File Id="id_file_be_pe_43" Name="$(var.OutputFileName).pe" />
                    </Component>
                  </Directory>

                  <Directory Id="id_dir_le_43" Name="le">
                    <Component Id="id_comp_files_le_43" Guid="$(var.guid_msm_comp_files_le_id_43)">
                      <File Id="id_file_le_binary_43" Name="$(var.OutputFileName).dll" KeyPath="yes"/>
                      <File Id="id_file_le_pdb_43" Name="$(var.OutputFileName).pdb" />
                      <File Id="id_file_le_pdbx_43" Name="$(var.OutputFileName).pdbx" />
                      <File Id="id_file_le_pe_43" Name="$(var.OutputFileName).pe" />
                    </Component>
                  </Directory>
                </Directory>
                <?endif ?>

              </Directory>
            </Directory>
          </Directory>
        </Directory>
      </Directory>

      <!--Registry stuff-->
      <!--NOTE: This is marked as win32 so that it puts it in the correct location in the registry on x64 machines with registry redirection-->
      <Component Id="id_comp_reg_key_netmf" Guid="$(var.guid_msm_comp_registry_id)" Win64="no">
        <!--Registry key for the designer - specifies the folder containing Gadgeteerhardware.xml -->
        <RegistryValue Id="VSAddinRegKey" Root="HKLM" Type="string" Key="SOFTWARE\Microsoft\.NETGadgeteer\v2\HardwareDefinitionFolders\$(var.OutputFileName)" Value="[INSTALLDIR]" />

        <?ifdef NETMF41Supported ?>
          <RegistryValue Id="NetMicroFxAssemblyGAC41" Root="HKLM" Type="string" Key="SOFTWARE\Microsoft\.NETMicroFramework\v4.1\AssemblyFoldersEx\$(var.OutputFileName)" Value="[INSTALLDIR]NETMF 4.1"/>
        <?endif ?>
        
        <?ifdef NETMF42Supported ?>
        <RegistryValue Id="NetMicroFxAssemblyGAC42" Root="HKLM" Type="string" Key="SOFTWARE\Microsoft\.NETMicroFramework\v4.2\AssemblyFoldersEx\$(var.OutputFileName)" Value="[INSTALLDIR]NETMF 4.2"/>
        <?endif ?>

        <?ifdef NETMF43Supported ?>
        <RegistryValue Id="NetMicroFxAssemblyGAC43" Root="HKLM" Type="string" Key="SOFTWARE\Microsoft\.NETMicroFramework\v4.3\AssemblyFoldersEx\$(var.OutputFileName)" Value="[INSTALLDIR]NETMF 4.3"/>
        <?endif ?>
      </Component>
      
    </Directory>

  </Module>
</Wix>